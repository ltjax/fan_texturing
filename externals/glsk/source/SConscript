#!/usr/bin/env python
Import('env', 'platform')
import os

# The replace makes sure the target file is free of excape chars
def generate_actions(source, target, env, for_signature):
	return env[ 'gperf' ]+' %s --output-file=%s' % (str(source[0]).replace('\\','/'), target[0])

env.Append( BUILDERS = { 'GPerf' : Builder(generator = generate_actions,suffix = '.cpp', src_suffix = '.gperf') } )

if platform == 'win32':
	file = 'win32_keycodes'

elif platform == 'linux2':
	file = 'x11_keycodes'

env.GPerf( file )

#Source File List
if platform == 'linux2':
	sources = Split("""
			config.cpp
			x11_main.cpp
			x11_window.cpp
			x11_input.cpp
			x11_keycodes.cpp
			x11_joystick.cpp
			pbuffer.cpp
			""")
elif platform == 'win32':
	sources = Split("""
			config.cpp
			win32_core.cpp
			win32_input.cpp
			win32_window.cpp
			win32_keycodes.cpp
			pbuffer.cpp
			win32_main.cpp
			""")

if platform == 'win32':
	glsk = env.Library('../lib/glsk', sources)

elif platform == 'linux2':
	glsk = env.Library('../lib/glsk-'+env[ 'GLSK_VERSION' ], sources)

Export('glsk')
